<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ozon | –ü–æ–ª–∏—Ç–ú–∞–π–Ω</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* ===== BASE ===== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f3f3f7;
}

/* ===== TOP BAR ===== */
.topbar {
  background: #6a00ff;
  color: white;
  padding: 10px 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.title {
  font-weight: bold;
  font-size: 16px;
}

.actions {
  display: flex;
  gap: 8px;
}

.cart-btn {
  background: rgba(0,0,0,0.25);
  color: white;
  border: none;
  border-radius: 14px;
  padding: 8px 14px;
  font-size: 18px;
  cursor: pointer;
}

.gear-btn {
  background: rgba(0,0,0,0.25);
  color: white;
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  font-size: 18px;
  cursor: pointer;
}

/* ===== CONTENT ===== */
.container {
  padding: 12px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 12px;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
}

.card.edit {
  border: 2px dashed #6a00ff;
}

.card img {
  width: 100%;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  border-radius: 12px;
}

.price {
  color: #6a00ff;
  font-size: 22px;
  font-weight: bold;
}

button.main-btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 12px;
  background: #6a00ff;
  color: white;
  font-size: 16px;
  margin-top: 8px;
  cursor: pointer;
}

/* ===== MODALS ===== */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.4);
  z-index: 20;
}

.modal-box {
  background: white;
  margin: 15% auto;
  padding: 16px;
  width: 90%;
  max-width: 400px;
  border-radius: 16px;
}

input {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
}

/* ===== TOAST ===== */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #2ecc71;
  color: white;
  padding: 10px 18px;
  border-radius: 20px;
  display: none;
  z-index: 30;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<header class="topbar">
  <span class="title">Ozon | –ü–æ–ª–∏—Ç–ú–∞–π–Ω</span>

  <div class="actions">
    <button class="cart-btn" onclick="openCart()">üß∫</button>
    <button class="gear-btn" onclick="toggleAdmin()">‚öôÔ∏è</button>
  </div>
</header>

<!-- ===== CONTENT ===== -->
<div class="container">
  <div class="card" id="productCard" onclick="cardClick()">
    <img src="dern.png" alt="–î—ë—Ä–Ω">
    <h3 id="name"></h3>
    <div>üì¶ –í –Ω–∞–ª–∏—á–∏–∏: <b id="stock"></b></div>
    <div class="price"><span id="price"></span> ‚ÇΩ / –±–ª–æ–∫</div>
    <button class="main-btn" onclick="addToCart(event)">üõí –í –∫–æ—Ä–∑–∏–Ω—É</button>
  </div>
</div>

<!-- ===== CART ===== -->
<div class="modal" id="cartModal">
  <div class="modal-box">
    <h2>üß∫ –ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cartInfo"></div>
    <button class="main-btn" onclick="closeCart()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- ===== EDITOR ===== -->
<div class="modal" id="editModal">
  <div class="modal-box">
    <h2>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
    <input id="editName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    <input id="editPrice" type="number" placeholder="–¶–µ–Ω–∞">
    <input id="editStock" type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
    <button class="main-btn" onclick="saveEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<div class="toast" id="toast">–ê–¥–º–∏–Ω–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

/* ===== CONFIG ===== */
const ADMIN_PASSWORD = "1979";

/* ===== STORAGE ===== */
const defaultProduct = { name: "–î—ë—Ä–Ω (—Ç—Ä–∞–≤–∞)", price: 25, stock: 64 };
let product = JSON.parse(localStorage.getItem("product")) || defaultProduct;
let cartCount = Number(localStorage.getItem("cart")) || 0;

let adminMode = false;

/* ===== RENDER ===== */
function render() {
  name.innerText = product.name;
  price.innerText = product.price;
  stock.innerText = product.stock;

  cartInfo.innerText =
    `${product.name} √ó ${cartCount} = ${cartCount * product.price} ‚ÇΩ`;

  productCard.classList.toggle("edit", adminMode);

  localStorage.setItem("product", JSON.stringify(product));
  localStorage.setItem("cart", cartCount);
}
render();

/* ===== CART ===== */
function addToCart(e) {
  e.stopPropagation();

  if (product.stock <= 0) {
    tg.showAlert("–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏");
    return;
  }

  product.stock--;
  cartCount++;
  render();
}

function openCart() {
  cartModal.style.display = "block";
}

function closeCart() {
  cartModal.style.display = "none";
}

/* ===== ADMIN MODE ===== */
function toggleAdmin() {
  if (!adminMode) {
    const pass = prompt("–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
    if (pass !== ADMIN_PASSWORD) return;
    adminMode = true;
    showToast();
  } else {
    adminMode = false;
  }
  render();
}

function cardClick() {
  if (!adminMode) return;

  editModal.style.display = "block";
  editName.value = product.name;
  editPrice.value = product.price;
  editStock.value = product.stock;
}

function saveEdit() {
  product.name = editName.value;
  product.price = Number(editPrice.value);
  product.stock = Number(editStock.value);
  editModal.style.display = "none";
  render();
}

/* ===== TOAST ===== */
function showToast() {
  toast.style.display = "block";
  setTimeout(() => toast.style.display = "none", 2000);
}
</script>

</body>
</html>
